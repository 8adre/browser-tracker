/*! wpt - v4.1.1 - 2014-01-26\n* Copyright (c) 2014 Billy Vong <billy@woopra.com>; Licensed  */(function(t,i){"use strict";var e,o,n,a={},s=[],r=!0,c=!0,h=!0;a.CONSTANTS={VERSION:11,ENDPOINT:"//www.woopra.com/track/"},a.extend=function(t,i){for(var e in i)t[e]=i[e]},a.cookie=function(t,e,o){if(void 0!==e){var n=o||{};if("number"==typeof n.expires){var a=n.expires,s=n.expires=new Date;s.setDate(s.getDate()+a)}return i.cookie=[encodeURIComponent(t),"=",encodeURIComponent(e),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}for(var r=function(t){return decodeURIComponent(t.replace(/\+/g," "))},c=function c(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t}catch(i){}},h=i.cookie.split("; "),p=t?void 0:{},u=0,l=h.length;l>u;u++){var g=h[u].split("="),d=r(g.shift()),f=r(g.join("="));if(t&&t===d){p=c(f);break}t||(p[d]=c(f))}return p},a.getCampaignData=function(){for(var t,i,e=a.getUrlParams(),o={},n=["source","medium","content","campaign","term"],s=0;n.length>s;s++)t=n[s],i=e["utm_"+t]||e["woo_"+t],i!==void 0&&(o["campaign_"+("campaign"===t?"name":t)]=i);return o},a.getCustomData=function(t,i){var e,o,n,s=a.getUrlParams(),r=i||"wv_";for(e in s)s.hasOwnProperty(e)&&(n=s[e],e.substring(0,r.length)===r&&(o=e.substring(r.length),t.call(this,o,n)))},a.getVisitorUrlData=function(t){a.getCustomData.call(t,t.identify,"wv_")},a.hideCampaignData=function(){var i=t.location.search.replace(/[?&]+((?:wv_|woo_|utm_)[^=&]+)=([^&]*)/gi,"");"?"!==i.substring(0,1)&&""!==i&&(i="?"+i),t.history&&t.history.replaceState&&t.history.replaceState(null,null,t.location.pathname+i)},a.getUrlParams=function(){var i={};return t.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,o){i[e]=decodeURIComponent(o.split("+").join(" "))}),i},a.buildUrlParams=function(t,i){var e,o=i||"",n=[];if(t===void 0)return t;for(e in t)t.hasOwnProperty(e)&&n.push(o+encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return n.join("&")},a.randomString=function(){var t,i,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o="";for(t=0;12>t;t++)i=Math.floor(Math.random()*e.length),o+=e.substring(i,i+1);return o},a.loadScript=function(t,e){var o,n,s=i.createElement("script");s.type="text/javascript",s.src=t,s.async=!0,e&&"function"==typeof e&&(n=e),s.onreadystatechange!==void 0?s.onreadystatechange=function(){(4===this.readyState||"complete"===this.readyState||"loaded"===this.readyState)&&n&&n(),a.removeScript(s)}:(s.onload=function(){n&&n(),a.removeScript(s)},s.onerror=function(){a.removeScript(s)}),o=i.getElementsByTagName("script")[0],o.parentNode.insertBefore(s,o)},a.removeScript=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},a.getHost=function(){return t.location.host.replace("www.","")},a.endsWith=function(t,i){return-1!==t.indexOf(i,t.length-i.length)},a.sleep=function(t){for(var i=new Date,e=new Date;t>e-i;)e=new Date},e=a._on=function(t,i){s[t]||(s[t]=[]),s[t].push(i)},a._fire=function(t){var i;if(s[t])for(i=0;s[t].length>i;i++)s[t][i].apply(this,Array.prototype.slice.call(arguments,1))},a.attachEvent=function(i,e,o){var n,a,s;t.document.attachEvent!==void 0?(n="attachEvent",a="on"+e):(n="addEventListener",a=e,s=!1),i[n](a,o,s)},a.leftClick=function(i){i=i||t.event;var e=i.which!==void 0&&1===i.which||i.button!==void 0&&0===i.button;return e&&!i.metaKey&&!i.altKey&&!i.ctrlKey&&!i.shiftKey},function(e,s){e(i,"mousedown",function(t){s("mousemove",t,new Date)}),e(i,"click",function(i){var e,p,u,l,g="_blank";if(e=i.srcElement||i.target,r||c){for(;e!==void 0&&null!==e&&(!e.tagName||"a"!==e.tagName.toLowerCase());)e=e.parentNode;e!==void 0&&null!==e&&(p=e,u=p.pathname.match(/(?:doc|dmg|eps|svg|xls|ppt|pdf|xls|zip|txt|vsd|vxd|js|css|rar|exe|wma|mov|avi|wmv|mp3|mp4|m4v)($|\&)/),l=!1,r&&u&&(s("download",p.href),p.target!==g&&a.leftClick(i)&&(i.preventDefault(),t.setTimeout(function(){t.location.href=p.href},o))),!c||u||p.hostname===t.location.hostname||h&&(-1===p.hostname.indexOf(t.location.hostname)||-1===t.location.hostname.indexOf(p.hostname))||-1!==p.hostname.indexOf("javascript")||""===p.hostname||(s("outgoing",p.href),p.target!==g&&a.leftClick(i)&&(i.preventDefault(),t.setTimeout(function(){t.location.href=p.href},n))))}}),e(i,"mousemove",function(t){s("mousemove",t,new Date)}),e(i,"keydown",function(){s("keydown")})}(a.attachEvent,a._fire);var p=function(i){this.visitorData={},this.sessionData={},this.options={},this.instanceName=i||"woopra",this.idle=0,this.cookie="",this.last_activity=new Date,this.loaded=!1,this.dirtyCookie=!1,this.version=a.CONSTANTS.VERSION,i&&""!==i&&(t[i]=this)};p.prototype={init:function(){this._setOptions(),this._processQueue("config"),this._setupCookie(),this._bindEvents(),this._processQueue(),this.loaded=!0},_setOptions:function(){var t=new Date;t.setDate(t.getDate()+365),this.config({domain:a.getHost(),app:"js-client",use_cookies:!0,cookie_name:"wooTracker",cookie_domain:null,cookie_path:"/",cookie_expire:t,ping:!0,ping_interval:12e3,idle_timeout:3e5,idle_threshold:1e4,download_pause:o||200,outgoing_pause:n||200,download_tracking:!0,outgoing_tracking:!0,outgoing_ignore_subdomain:!0,hide_campaign:!1,save_url_hash:!0,ignore_query_url:!0})},_processQueue:function(i){var e,o,n,a=t.__woo?t.__woo[this.instanceName]:t._w[this.instanceName];if(a&&a._e)for(n=a._e,e=0;n.length>e;e++)o=n[e],void 0===o||!this[o[0]]||void 0!==i&&i!==o[0]||this[o[0]].apply(this,Array.prototype.slice.call(o,1))},_setupCookie:function(){this.cookie=a.cookie(this.config("cookie_name")),this.cookie&&this.cookie.length>0||(this.cookie=a.randomString()),null===this.config("cookie_domain")&&(a.endsWith(t.location.host,"."+this.config("domain"))?this.config("cookie_domain",this.config("domain")):this.config("cookie_domain",a.getHost())),a.cookie(this.config("cookie_name"),this.cookie,{expires:this.config("cookie_expire"),path:this.config("cookie_path"),domain:this.config("cookie_domain")}),this.dirtyCookie=!0},_bindEvents:function(){var t=this;e("mousemove",function(){t.moved.apply(t,arguments)}),e("keydown",function(){t.typed.apply(t,arguments)}),e("download",function(){t.downloaded.apply(t,arguments)}),e("outgoing",function(){t.outgoing.apply(t,arguments)})},_dataSetter:function(t,i,e){var o;if(i===void 0)return t;if(e===void 0){if("string"==typeof i)return t[i];if("object"==typeof i)for(o in i)i.hasOwnProperty(o)&&("cookie_"===o.substring(0,7)&&(this.dirtyCookie=!0),t[o]=i[o])}else"cookie_"===i.substring(0,7)&&(this.dirtyCookie=!0),t[i]=e;return this},_push:function(t){var i,e,o,n,s,r=t||{},c=this.config("protocol"),h=c&&""!==c?c+":":"",p=h+a.CONSTANTS.ENDPOINT+r.endpoint+"/",u="ra="+a.randomString(),l=[["visitorData","cv_"],["eventData","ce_"],["sessionData","cs_"]],g=[];a.getVisitorUrlData(this),this.config("hide_campaign")&&a.hideCampaignData(),g.push(u),g.push(a.buildUrlParams(this.getOptionParams()));for(s in l)l.hasOwnProperty(s)&&(n=l[s],r[n[0]]&&(e=a.buildUrlParams(r[n[0]],n[1]),e&&g.push(e)));i="?"+g.join("&"),o=p+i,a.loadScript(o,r.callback)},config:function(t,i){var e=this._dataSetter(this.options,t,i);return e===this&&(6e3>this.options.ping_interval?this.options.ping_interval=6e3:this.options.ping_interval>6e4&&(this.options.ping_interval=6e4),c=c&&this.options.outgoing_tracking,n=this.options.outgoing_pause,r=r&&this.options.download_tracking,o=this.options.download_pause,h=h&&this.options.outgoing_ignore_subdomain,this.dirtyCookie&&this.loaded&&this._setupCookie()),e},visit:function(t,i){return this._dataSetter(this.sessionData,t,i)},identify:function(t,i){return this._dataSetter(this.visitorData,t,i)},call:function(t){this[t]&&"function"==typeof this[t]&&this[t].apply(this,Array.prototype.slice.call(arguments,1))},track:function(t,i){var e,o,n={},s=arguments[arguments.length-1];a.extend(n,a.getCampaignData()),"function"==typeof s&&(e=s),t===void 0||t===e?n.name="pv":i===void 0||i===e?("string"==typeof t&&(n.name=t),"object"==typeof t&&this._dataSetter(n,t)):(this._dataSetter(n,i),n.name=t),"pv"===n.name&&(n.url=n.url||this.getPageUrl(),n.title=n.title||this.getPageTitle(),this.config("save_url_hash")&&(o=n.hash||this.getPageHash(),""!==o&&(n.hash=o))),this._push({endpoint:"ce",visitorData:this.visitorData,sessionData:this.sessionData,eventData:n,callback:e}),this.startPing()},startPing:function(){var i=this;this.pingInterval===void 0&&(this.pingInterval=t.setInterval(function(){i.ping()},this.config("ping_interval")))},stopPing:function(){this.pingInterval!==void 0&&(t.clearInterval(this.pingInterval),delete this.pingInterval)},ping:function(){var t;return this.config("ping")&&this.idle<this.config("idle_timeout")?this._push({endpoint:"ping"}):this.stopPing(),t=new Date,t-this.last_activity>this.config("idle_threshold")&&(this.idle=t-this.last_activity),this},push:function(t){return this._push({endpoint:"identify",visitorData:this.visitorData,sessionData:this.sessionData,callback:t}),this},sleep:function(t){a.sleep(t)},moved:function(t,i){this.last_activity=i,this.idle=0},typed:function(){this.vs=2},downloaded:function(t){this.track("download",{url:t})},outgoing:function(t){this.track("outgoing",{url:t})},reset:function(){a.cookie(this.config("cookie_name"),""),this._setupCookie()},getPageUrl:function(){return this.options.ignore_query_url?t.location.pathname:t.location.pathname+t.location.search},getPageHash:function(){return t.location.hash},getPageTitle:function(){return 0===i.getElementsByTagName("title").length?"":i.getElementsByTagName("title")[0].innerHTML},getOptionParams:function(){var e={alias:this.config("domain"),instance:this.instanceName,ka:this.config("keep_alive")||2*this.config("ping_interval"),meta:a.cookie("wooMeta")||"",screen:t.screen.width+"x"+t.screen.height,language:t.navigator.browserLanguage||t.navigator.language||"",app:this.config("app"),referer:i.referrer,idle:""+parseInt(this.idle/1e3,10),vs:"i"};return this.config("use_cookies")&&(e.cookie=a.cookie(this.config("cookie_name"))||""),this.config("ip")&&(e.ip=this.config("ip")),2===this.vs?(e.vs="w",this.vs=0):0===this.idle&&(e.vs="r"),e},dispose:function(){this.stopPing(),t[this.instanceName]!==void 0&&delete t[this.instanceName]}};var u=t.__woo||t._w;if(u!==void 0)for(var l in u)if(u.hasOwnProperty(l)){var g=new p(l);g.init(),t.woopraTracker===void 0&&(t.woopraTracker=g)}t.WoopraTracker=p,t.WoopraLoadScript=a.loadScript,t.exports!==void 0&&(a.Tracker=p,t.exports.Woopra=a)})(window,document);