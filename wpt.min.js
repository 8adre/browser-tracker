/*! wpt - v3.0.1 - 2013-07-17\n* Copyright (c) 2013 Billy Vong <billy@woopra.com>; Licensed  */(function(t,i){"use strict";var e={};e.CONSTANTS={VERSION:11,ENDPOINT:"//www.woopra.com/track/"},e.extend=function(t,i){for(var e in i)t[e]=i[e]},e.readCookie=function(e){var n,o,a;return""===e?"":(n=""+i.cookie,o=n.indexOf(e),-1===o?"":(a=n.indexOf(";",o),-1===a&&(a=n.length),t.unescape(n.substring(o+e.length+1,a))))},e.setCookie=function(t,e,n,o,a){var s=[];s.push(t+"="+e),s.push("expires="+n),s.push("path="+a),s.push("domain=."+o),i.cookie=s.join("; ")},e.getCampaignData=function(){for(var t,i,n=e.getUrlParams(),o={},a=["source","medium","content","campaign","term"],s=0;a.length>s;s++)t=a[s],i=n["utm_"+t]||n["woo_"+t],i!==void 0&&(o["campaign_"+("campaign"===t?"name":t)]=i);return o},e.getUrlParams=function(){var i={};return t.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,n){i[e]=decodeURIComponent(n.split("+").join(" "))}),i},e.buildUrlParams=function(t,i){var e,n=i||"",o=[];if(t===void 0)return t;for(e in t)o.push(n+encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return o.join("&")},e.randomString=function(){var t,i,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="";for(t=0;12>t;t++)i=Math.floor(Math.random()*e.length),n+=e.substring(i,i+1);return n},e.loadScript=function(t,n){var o,a,s=i.createElement("script");s.type="text/javascript",s.src=t,s.async=!0,n&&"function"==typeof n&&(a=n),s.onreadystatechange!==void 0?s.onreadystatechange=function(){(4===this.readyState||"complete"===this.readyState||"loaded"===this.readyState)&&(a&&a(),e.removeScript(s))}:s.onload=function(){a&&a(),e.removeScript(s)},o=i.getElementsByTagName("script")[0],o.parentNode.insertBefore(s,o)},e.removeScript=function(t){t.parentNode.removeChild(t)},e.getHost=function(){return t.location.host.replace("www.","")},e.endsWith=function(t,i){return-1!==t.indexOf(i,t.length-i.length)};var n=function(i,e,n){var o,a,s;t.document.attachEvent!==void 0?(o="attachEvent",a="on"+e):(o="addEventListener",a=e,s=!1),i[o](a,n,s)},o=function(i){this.visitorData={},this.sessionData={},this.options={},this.instanceName=i,this.idle=0,this.cookie="",this.last_activity=new Date,this._loaded=!1,this.version=e.CONSTANTS.VERSION,i&&""!==i&&(t[i]=this)};if(o.prototype={init:function(){this._setOptions(),this._processQueue("config"),this._setupCookie(),this._bindEvents(),this._loaded=!0,this._processQueue()},_setOptions:function(){var t=new Date;t.setDate(t.getDate()+365),this.config({domain:e.getHost(),cookie_name:"wooTracker",cookie_domain:null,cookie_path:"/",cookie_expire:t,ping:!0,ping_interval:12e3,idle_timeout:3e5,idle_threshold:1e4,download_pause:200,outgoing_pause:400,download_tracking:!0,outgoing_tracking:!0,ignore_query_url:!0})},_processQueue:function(i){var e,n,o,a=t._w[this.instanceName];if(a&&a._e)for(o=a._e,e=0;o.length>e;e++)n=o[e],void 0===n||!this[n[0]]||void 0!==i&&i!==n[0]||this[n[0]].apply(this,Array.prototype.slice.call(n,1))},_setupCookie:function(){this.cookie=e.readCookie(this.config("cookie_name")),this.cookie&&this.cookie.length>0||(this.cookie=e.randomString()),null===this.config("cookie_domain")&&(e.endsWith(t.location.host,"."+this.config("domain"))?this.config("cookie_domain",this.config("domain")):this.config("cookie_domain",e.getHost())),e.setCookie(this.config("cookie_name"),this.cookie,this.config("cookie_exp"),this.config("cookie_domain"),this.config("cookie_path"))},_bindEvents:function(){var t=this;n(i,"mousedown",function(){t.clicked.apply(t,arguments)}),n(i,"mousemove",function(){t.moved.apply(t,arguments)}),n(i,"keydown",function(){t.typed.apply(t,arguments)})},_dataSetter:function(t,i,e){var n;if(i===void 0)return t;if(e===void 0){if("string"==typeof i)return t[i];if("object"==typeof i)for(n in i)t[n]=i[n]}else t[i]=e;return this},_push:function(t){var i,n,o,a,s=t||{},r=e.CONSTANTS.ENDPOINT+s.endpoint+"/",c="ra="+e.randomString(),h=[["visitorData","cv_"],["eventData","ce_"],["sessionData","cs_"]],p=[];p.push(c),p.push(e.buildUrlParams(this.getOptionParams()));for(a in h)o=h[a],s[o[0]]&&p.push(e.buildUrlParams(s[o[0]],o[1]));i="?"+p.join("&"),n=r+i,e.loadScript(n,s.callback)},config:function(t,i){var e=this._dataSetter(this.options,t,i);return e===this&&(6e3>this.options.ping_interval?this.options.ping_interval=6e3:this.options.ping_interval>6e4&&(this.options.ping_interval=6e4)),e},visit:function(t,i){return this._dataSetter(this.sessionData,t,i)},identify:function(t,i){return this._dataSetter(this.visitorData,t,i)},call:function(t){this[t]&&"function"==typeof this[t]&&this[t].apply(this,Array.prototype.slice.call(arguments,1))},track:function(t,i){var n,o={},a=arguments[arguments.length-1];e.extend(o,e.getCampaignData()),"function"==typeof a&&(n=a),t===void 0||t===n?(o.name="pv",o.url=this.getPageUrl(),o.title=this.getPageTitle()):i===void 0||i===n?("string"==typeof t&&(o.name=t),"object"==typeof t&&this._dataSetter(o,t)):(o.name=t,this._dataSetter(o,i)),this._push({endpoint:"ce",visitorData:this.visitorData,sessionData:this.sessionData,eventData:o,callback:n}),this.startPing()},startPing:function(){var i=this;this.pingInterval===void 0&&(this.pingInterval=t.setInterval(function(){i.ping()},this.config("ping_interval")))},stopPing:function(){this.pingInterval!==void 0&&(t.clearInterval(this.pingInterval),delete this.pingInterval)},ping:function(){var t;return this.config("ping")&&this.idle<this.config("idle_timeout")?this._push({endpoint:"ping"}):this.stopPing(),t=new Date,t-this.last_activity>this.config("idle_threshold")&&(this.idle=t-this.last_activity),this},push:function(t){return this._push({endpoint:"identify",visitorData:this.visitorData,sessionData:this.sessionData,callback:t}),this},sleep:function(t){for(var i=new Date,e=new Date;t>e-i;)e=new Date},moved:function(){this.last_activity=new Date,this.idle=0},typed:function(){this.vs=2},clicked:function(i){var e,n,o,a;for(this.moved(),e=i.srcElement||i.target;e!==void 0&&null!==e&&(!e.tagName||"a"!==e.tagName.toLowerCase());)e=e.parentNode;e!==void 0&&null!==e&&(n=e,o=n.pathname.match(/(?:doc|dmg|eps|jpg|jpeg|png|svg|xls|ppt|pdf|xls|zip|txt|vsd|vxd|js|css|rar|exe|wma|mov|avi|wmv|mp3|mp4|m4v)($|\&)/),a=!1,this.config("download_tracking")&&o&&0>(""+n.href).indexOf("woopra-ns.com")&&(this.track("download",{url:n.href}),this.sleep(this.config("download_pause"))),this.config("outgoing_tracking")&&(o||n.hostname===t.location.host||-1!==n.hostname.indexOf("javascript")||""===n.hostname||(this.track("outgoing",{url:n.href}),this.sleep(this.config("outgoing_pause")))))},getPageUrl:function(){return this.options.ignore_query_url?t.location.pathname:t.location.pathname+t.location.search},getPageTitle:function(){return 0===i.getElementsByTagName("title").length?"":i.getElementsByTagName("title")[0].innerHTML},getOptionParams:function(){var n={alias:this.config("domain"),instance:this.instanceName,cookie:e.readCookie(this.config("cookie_name")),ka:this.config("keep_alive")||2*this.config("ping_interval"),meta:e.readCookie("wooMeta")||"",screen:t.screen.width+"x"+t.screen.height,language:t.navigator.browserLanguage||t.navigator.language||"",referer:i.referrer,idle:""+parseInt(this.idle/1e3,10),vs:"i"};return 2===this.vs?(n.vs="w",this.vs=0):0===this.idle&&(n.vs="r"),n},dispose:function(){this.stopPing(),t[this.instanceName]!==void 0&&delete t[this.instanceName]}},t._w!==void 0)for(var a in t._w){var s=new o(a);s.init()}t.WoopraTracker=o,t.WoopraScript=e.loadScript,t.exports!==void 0&&(e.Tracker=o,t.exports.Woopra=e)})(window,document);