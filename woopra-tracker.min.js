(function(e,t){"use strict";var n={};n.Script=function(e,t,n,r){this.scriptObject=!1,this.file=e,this.src=this.getEndpoint()+t,this.hook=n,this.async=r},n.Script.prototype={getProtocol:function(){return e.location.protocol},getEndpoint:function(){return this.getProtocol()+"//www.woopra.com/track/"+this.file+"/"},clear:function(){this.scriptObject.parentNode.removeChild(this.scriptObject)},load:function(){var n=t.createElement("script"),r,i=this.hook;n.src=this.src,n.async=this.async,i&&(typeof n.onreadystatechange!="undefined"?n.onreadystatechange=function(){(this.readyState==="complete"||this.readyState==="loaded")&&e.setTimeout(i,400)}:n.onload=function(){e.setTimeout(function(){i.apply()},400)}),r=t.getElementsByTagName("script")[0],r.parentNode.insertBefore(n,r)}},n.Event=function(e,t,n,r){this.name=e||"unknown",this.ce=t||{},this.cv=n||{},this.file=r||"ce",this.requestString="",this.attachCampaignData()},n.Event.prototype={attachCampaignData:function(){var e=this.getUrlVars(),t,n,r,i=["source","medium","content","campaign","term"];for(t=0;t<i.length;t++)n=i[t],r=e["utm_"+n]||e["woo_"+n],typeof r!="undefined"&&(this.ce["woo_"+n]=r)},getUrlVars:function(){var t={};return e.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,n,r){t[n]=r}),t},addProperty:function(e,t){this.ce[e]=t},serialize:function(e,t){var n,r;if(this.requestString.length>4e3||typeof e=="undefined"||typeof e=="function")return;if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){this.requestString+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e);return}if(e instanceof Array){for(n=0;n<e.length;n++)this.serialize(e[n],t+"["+n+"]");return}for(r in e)e.hasOwnProperty(r)&&this.serialize(e[r],t+"."+r)},fire:function(t){var r=t,i,s=r.getRequestData()||{};r.ensure(),this.addProperty("name",this.name),this.requestString="";for(i in s)s.hasOwnProperty(i)&&this.serialize(s[i],i);for(i in this.cv)this.cv.hasOwnProperty(i)&&this.serialize(this.cv[i],"cv_"+i);for(i in this.ce)this.ce.hasOwnProperty(i)&&this.serialize(this.ce[i],"ce_"+i);r.option("performance")&&e.performance&&this.serialize(e.performance,"ce_performance");var o=new n.Script(this.file,"?ra="+r.randomstring()+this.requestString,function(){},!0);o.load()}},n.Tracker=function(){this.chat=!1,this.alias="",this.vs=0,this.props={},this.cv={},this.cs={},this.pint=!1,this.ctr=0,this.version=20,this.last_activity=new Date,this.idle=0,this.inited=0,this._loaded=!1},n.Tracker.prototype={initialize:function(){this._setOptions(),this._processQueue(),this._loaded=!0,typeof e.woopraReady!="undefined"&&e.woopraReady(this)},_processQueue:function(){var t,n,r=e._wpt;if(r&&r._e)for(t=0;t<r._e.length;t++)n=r._e[t],typeof n!="undefined"&&this[n[0]].apply(this,Array.prototype.slice.call(n,1));e._wpt=this},_setOptions:function(){var t=this,n=new Date;n.setDate(n.getDate()+365),this.option({domain:e.location.hostname,cookie_name:"wooTracker",cookie_domain:e.location.hostname,cookie_path:"/",cookie_expire:n,ping:!0,ping_interval:12e3,idle_timeout:3e5,download_pause:200,outgoing_pause:400,download_tracking:!0,outgoing_tracking:!0})},ensure:function(){var n=this,r,i;if(n.inited===0){n.inited=1,r=n.option("cookie_name"),i=n.readcookie(r);if(!i||i.length<=0)i=n.randomstring();n.createcookie(r,i),e.setInterval(function(){n.next()},1e3),typeof t.attachEvent!="undefined"?(t.attachEvent("onmousedown",function(){n.clicked.apply(n,arguments)}),t.attachEvent("onmousemove",function(){n.moved.apply(n,arguments)}),t.attachEvent("onkeydown",function(){n.typed.apply(n,arguments)})):(t.addEventListener("mousedown",function(){n.clicked.apply(n,arguments)},!1),t.addEventListener("mousemove",function(){n.moved.apply(n,arguments)},!1),t.addEventListener("keydown",function(){n.typed.apply(n,arguments)},!1))}},sleep:function(e){var t=new Date,n=new Date;while(n-t<e)n=new Date},randomstring:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t,n,r="";for(t=0;t<12;t++)n=Math.floor(Math.random()*e.length),r+=e.substring(n,n+1);return r},readcookie:function(n){var r=t.cookie+"",i,s;return i=r.indexOf(n),i===-1||n===""?"":(s=r.indexOf(";",i),s===-1&&(s=r.length),e.unescape(r.substring(i+n.length+1,s)))},createcookie:function(e,n){var r=this,i;i=e+"="+n+"; "+"expires="+r.option("cookie_expire")+";"+"path="+r.option("cookie_path")+";domain=."+r.option("cookie_domain"),t.cookie=i},getRequestData:function(){var n=this,r={};return r.alias=n.option("domain"),r.cookie=n.readcookie(n.option("cookie_name")),r.meta=n.readcookie("wooMeta")||"",r.screen=e.screen.width+"x"+e.screen.height,r.language=e.navigator.browserLanguage||e.navigator.language||"",r.referer=t.referrer,r.idle=parseInt(n.idle/1e3,10),n.vs===2?(r.vs="w",n.vs=0):n.idle===0?r.vs="r":r.vs="i",r},call:function(e,t){},pageview:function(e){this._track("pv","visit",e)},track:function(e,t){this._track(e,"ce",t)},_track:function(e,t,n){var r=n||{};typeof r.visitor!="undefined"&&(this.cv=r.visitor,delete r.visitor),this._sync(e,t,r)},_sync:function(e,t,r){var i;i=new n.Event(e,r,this.cv,t),i.fire(this)},identify:function(e,t){typeof e!="undefined"&&e!==""&&(typeof t!="undefined"&&(this.cv=t),this.visitor("email",e),this._sync("identify","identify",{}))},visitor:function(e,t){typeof e=="string"&&typeof t!="undefined"?this.cv[e]=t:typeof e=="object"&&(this.cv=e)},visit:function(e,t){typeof e=="string"&&typeof t!="undefined"?this.cs[e]=t:typeof e=="object"&&(this.cs=e)},option:function(e,t){if(typeof t=="undefined"){if(typeof e!="object")return this.props[e];this.props=e}else this.props[e]=t;return t},setDomain:function(e){this.option("domain",e),this.option("cookie_domain",e)},setIdleTimeout:function(e){this.option("idle_timeout",e)},pingServer:function(){this._sync("x","ping",{})},typed:function(){this.vs=2},clicked:function(t){var r=this;r.moved();var i=t.srcElement||t.target;while(typeof i!="undefined"&&i!==null){if(i.tagNam==="A")break;i=i.parentNode}if(typeof i!="undefined"&&i!==null){var s=i,o=s.pathname.match(/(?:doc|dmg|eps|jpg|jpeg|png|svg|xls|ppt|pdf|xls|zip|txt|vsd|vxd|js|css|rar|exe|wma|mov|avi|wmv|mp3|mp4|m4v)($|\&)/),u=!1;r.option("download_tracking")&&o&&s.href.toString().indexOf("woopra-ns.com")<0&&(u=new n.Event("download",{url:s.href}),u.addProperty("url",s.href),u.fire(this),r.sleep(r.option("download_pause"))),r.option("outgoing_tracking")&&!o&&s.hostname!==e.location.host&&s.hostname.indexOf("javascript")===-1&&s.hostname!==""&&(u=new n.Event("outgoing",{url:s.href}),u.fire(this),r.sleep(r.option("outgoing_pause")))}},moved:function(){var e=this;e.last_activity=new Date,e.idle=0},next:function(){var e,t=this;t.ctr++,t.ctr*1e3>t.option("ping_interval")&&(t.ctr=0,t.option("ping")&&t.idle<t.option("idle_timeout")&&t.pingServer()),e=new Date,e-t.last_activity>1e4&&(t.idle=e-t.last_activity)}};var r=new n.Tracker;r.initialize(),typeof e.exports!="undefined"&&(e.exports.Woopra=n)})(window,document);