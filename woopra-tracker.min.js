/*! woopra-tracker - v3.0.1 - 2013-06-24\n* Copyright (c) 2013 Billy Vong <billy@woopra.com>; Licensed  */(function(t,i){"use strict";var e={};t.console,e.CONSTANTS={ENDPOINT:t.location.protocol+"//www.woopra.com/track/",EVENT_ENDPOINT:t.location.protocol+"//www.woopra.com/track/ce/",PING_ENDPOINT:t.location.protocol+"//www.woopra.com/track/ping/"},e.extend=function(t,i){for(var e in i)t[e]=i[e]},e.readCookie=function(e){if(""===e)return"";var o=""+i.cookie,n=o.indexOf(e);if(-1===n)return"";var a=o.indexOf(";",n);return-1===a&&(a=o.length),t.unescape(o.substring(n+e.length+1,a))},e.setCookie=function(t,e,o,n,a){var r=[];r.push(t+"="+e),r.push("expires="+o),r.push("path="+a),r.push("domain=."+n),i.cookie=r.join("; ")},e.getCampaignData=function(){for(var t=e.getUrlParams(),i={},o=["source","medium","content","campaign","term"],n=0;o.length>n;n++){var a=o[n],r=t["utm_"+a]||t["woo_"+a];r!==void 0&&(i["campaign_"+("campaign"==a?"name":a)]=r)}return i},e.getUrlParams=function(){var i={};return t.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,o){i[e]=decodeURIComponent(o.split("+").join(" "))}),i},e.buildUrlParams=function(t,i){var e,o=i||"",n=[];if(t===void 0)return t;for(e in t)n.push(o+encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return n.join("&")},e.randomString=function(){var t,i,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o="";for(t=0;12>t;t++)i=Math.floor(Math.random()*e.length),o+=e.substring(i,i+1);return o},e.loadScript=function(t,o){var n,a=i.createElement("script");a.type="text/javascript",a.src=t,a.async=!0,a.onreadystatechange!==void 0?a.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&(o&&o(),e.removeScript(a))}:a.onload=function(){o&&o(),e.removeScript(a)},n=i.getElementsByTagName("script")[0],n.parentNode.insertBefore(a,n)},e.removeScript=function(t){t.parentNode.removeChild(t)},e.getHost=function(){return t.location.host.replace("www.","")},e.endsWith=function(t,i){return-1!==t.indexOf(i,t.length-i.length)};var o=function(t){this.visitorData={},this.sessionData={},this.options={},this.instanceName=t,this.idle=0,this.cookie="",this._loaded=!1};o.prototype={init:function(){this._setOptions(),this._processQueue("config"),this._setupCookie(),this._loaded=!0,this._processQueue()},_processQueue:function(i){var e,o,n,a=t._wpt[this.instanceName];if(a&&a._e)for(n=a._e,e=0;n.length>e;e++)o=n[e],void 0===o||!this[o[0]]||void 0!==i&&i!==o[0]||this[o[0]].apply(this,Array.prototype.slice.call(o,1))},_setOptions:function(){var t=new Date;t.setDate(t.getDate()+365),this.config({domain:e.getHost(),cookie_name:"wooTracker",cookie_domain:null,cookie_path:"/",cookie_expire:t,ping:!0,ping_interval:12e3,idle_timeout:3e5,download_pause:200,outgoing_pause:400,download_tracking:!0,outgoing_tracking:!0,ignore_query_url:!0})},_setupCookie:function(){this.cookie=e.readCookie(this.config("cookie_name")),this.cookie&&this.cookie.length>0||(this.cookie=e.randomString()),null===this.config("cookie_domain")&&(e.endsWith(t.location.host,"."+this.config("domain"))?this.config("cookie_domain",this.config("domain")):this.config("cookie_domain",e.getHost())),e.setCookie(this.config("cookie_name"),this.cookie,this.config("cookie_exp"),this.config("cookie_domain"),this.config("cookie_path"))},_dataSetter:function(t,i,e){var o;if(i===void 0)return t;if(e===void 0){if("string"==typeof i)return t[i];if("object"==typeof i)for(o in i)t[o]=i[o]}else t[i]=e;return this},_push:function(t,i){var o,n,a=i||{},r=e.CONSTANTS.ENDPOINT+t+"/",s="ra="+e.randomString(),c=[];c.push(s),c.push(e.buildUrlParams(this.getOptionParams())),a.visitorData&&c.push(e.buildUrlParams(a.visitorData,"cv_")),a.eventData&&c.push(e.buildUrlParams(a.eventData,"ce_")),o="?"+c.join("&"),n=r+o,e.loadScript(n,a.callback)},config:function(t,i){return this._dataSetter(this.options,t,i)},visit:function(t,i){return this._dataSetter(this.sessionData,t,i)},identify:function(t,i){var e=this._dataSetter(this.visitorData,t,i);return e},call:function(){},track:function(t,i){var o,n={};e.extend(n,e.getCampaignData()),t===void 0?(n.name="pv",n.url=this.getPageUrl(),n.title=this.getPageTitle()):"undefined"===i?("string"==typeof t&&(n.name=t),"object"==typeof t&&this._dataSetter(n,t)):(n.name=t,this._dataSetter(n,i)),"function"==typeof n.hitCallback&&(o=n.hitCallback,delete n.hitCallback),this._push("ce",{visitorData:this.visitorData,eventData:n,callback:o}),this.startPing()},startPing:function(){var i=this;this.pingInterval===void 0&&(t.clearInterval(this.pingInterval),delete this.pingInterval),this.pingInterval=t.setInterval(function(){i.ping()},this.config("ping_interval"))},ping:function(){return this._push("ping",{visitorData:this.visitorData}),this},push:function(){return this._push("identify",{visitorData:this.visitorData}),this},getPageUrl:function(){return this.options.ignore_query_url?t.location.pathname:t.location.pathname+t.location.search},moved:function(){var t=this;t.last_activity=new Date,t.idle=0},typed:function(){this.vs=2},getPageTitle:function(){return 0===i.getElementsByTagName("title").length?"":i.getElementsByTagName("title")[0].innerHTML},getOptionParams:function(){var o={alias:this.config("domain"),cookie:e.readCookie(this.config("cookie_name")),meta:e.readCookie("wooMeta")||"",screen:t.screen.width+"x"+t.screen.height,language:t.navigator.browserLanguage||t.navigator.language||"",referer:i.referrer,idle:""+parseInt(this.idle/1e3,10),vs:"w"};return o}};var n={Tracker:o};if(t._wpt!==void 0)for(var a in t._wpt){var r=new o(a);r.init(),t[a]=r}t.Woopra=n||{},t.exports!==void 0&&(e.Tracker=o,t.exports.Woopra=e)})(window,document);