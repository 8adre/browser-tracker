/*! woopra-tracker - v3.0.0 - 2013-03-13\n* Copyright (c) 2013 Billy Vong <billy@woopra.com>; Licensed  */(function(t,e){"use strict";var i={};i.Script=function(t,e,i){this.scriptObject=!1,this.src=t,this.hook=e,this.async=i},i.Script.prototype={clear:function(){this.scriptObject.parentNode.removeChild(this.scriptObject)},load:function(){var i,o=e.createElement("script"),n=this.hook;o.src=this.src,o.async=this.async,n&&(o.onreadystatechange!==void 0?o.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&t.setTimeout(n,400)}:o.onload=function(){t.setTimeout(function(){n()},400)}),i=e.getElementsByTagName("script")[0],i.parentNode.insertBefore(o,i)}},i.Event=function(t,e,i,o){this.name=t||"unknown",this.ce=e||{},this.cv=i||{},this.file=o||"ce",this.requestString="",this.attachCampaignData()},i.Event.prototype={getProtocol:function(){return t.location.protocol},getEndpoint:function(t){return this.getProtocol()+"//www.woopra.com/track/"+t+"/"},attachCampaignData:function(){var t,e,i,o=this.getUrlVars(),n=["source","medium","content","campaign","term"];for(t=0;n.length>t;t++)e=n[t],i=o["utm_"+e]||o["woo_"+e],i!==void 0&&(this.ce["woo_"+e]=i)},getUrlVars:function(){var e={};return t.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,o){e[i]=o}),e},addProperty:function(t,e){this.ce[t]=e},serialize:function(t,e){var i,o;if(!(this.requestString.length>4e3||t===void 0||"function"==typeof t)){if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return this.requestString+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t),void 0;if(t instanceof Array)for(i=0;t.length>i;i++)this.serialize(t[i],e+"["+i+"]");else for(o in t)t.hasOwnProperty(o)&&this.serialize(t[o],e+"."+o)}},fire:function(e){var o,n=e,r=n.getRequestData()||{};n.ensure(),this.addProperty("name",this.name),this.requestString="";for(o in r)r.hasOwnProperty(o)&&this.serialize(r[o],o);for(o in this.cv)this.cv.hasOwnProperty(o)&&this.serialize(this.cv[o],"cv_"+o);for(o in this.ce)this.ce.hasOwnProperty(o)&&this.serialize(this.ce[o],"ce_"+o);n.option("performance")&&t.performance&&this.serialize(t.performance,"ce_performance");var a=new i.Script(this.getEndpoint(this.file)+"?ra="+n.randomstring()+this.requestString,function(){},!0);a.load()}},i.Tracker=function(){this.chat=!1,this.alias="",this.vs=0,this.props={},this.cv={},this.cs={},this.pint=!1,this.ctr=0,this.version=20,this.last_activity=new Date,this.idle=0,this.inited=0,this._loaded=!1},i.Tracker.prototype={initialize:function(){this._setOptions(),this._processQueue(),this._loaded=!0,t.woopraReady!==void 0&&t.woopraReady(this)},_processQueue:function(){var e,i,o,n=t._wpt;if(n&&n._e)for(o=n._e,t._wpt=this,e=0;o.length>e;e++)i=o[e],i!==void 0&&this[i[0]].apply(this,Array.prototype.slice.call(i,1))},_setOptions:function(){var e=new Date;e.setDate(e.getDate()+365),this.option({domain:t.location.hostname,cookie_name:"wooTracker",cookie_domain:t.location.hostname,cookie_path:"/",cookie_expire:e,ping:!0,ping_interval:12e3,idle_timeout:3e5,download_pause:200,outgoing_pause:400,download_tracking:!0,outgoing_tracking:!0})},ensure:function(){var i,o,n=this;0===n.inited&&(n.inited=1,i=n.option("cookie_name"),o=n.readcookie(i),(!o||0>=o.length)&&(o=n.randomstring()),n.createcookie(i,o),t.setInterval(function(){n.next()},1e3),e.attachEvent!==void 0?(e.attachEvent("onmousedown",function(){n.clicked.apply(n,arguments)}),e.attachEvent("onmousemove",function(){n.moved.apply(n,arguments)}),e.attachEvent("onkeydown",function(){n.typed.apply(n,arguments)})):(e.addEventListener("mousedown",function(){n.clicked.apply(n,arguments)},!1),e.addEventListener("mousemove",function(){n.moved.apply(n,arguments)},!1),e.addEventListener("keydown",function(){n.typed.apply(n,arguments)},!1)))},sleep:function(t){for(var e=new Date,i=new Date;t>i-e;)i=new Date},randomstring:function(){var t,e,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o="";for(t=0;12>t;t++)e=Math.floor(Math.random()*i.length),o+=i.substring(e,e+1);return o},readcookie:function(i){var o,n,r=e.cookie+"";return o=r.indexOf(i),-1===o||""===i?"":(n=r.indexOf(";",o),-1===n&&(n=r.length),t.unescape(r.substring(o+i.length+1,n)))},createcookie:function(t,i){var o,n=this;o=t+"="+i+"; "+"expires="+n.option("cookie_expire")+";"+"path="+n.option("cookie_path")+";domain=."+n.option("cookie_domain"),e.cookie=o},getRequestData:function(){var i=this,o={};return o.alias=i.option("domain"),o.cookie=i.readcookie(i.option("cookie_name")),o.meta=i.readcookie("wooMeta")||"",o.screen=t.screen.width+"x"+t.screen.height,o.language=t.navigator.browserLanguage||t.navigator.language||"",o.referer=e.referrer,o.idle=parseInt(i.idle/1e3,10),2===i.vs?(o.vs="w",i.vs=0):o.vs=0===i.idle?"r":"i",o},call:function(){},pageview:function(t){this._track("pv","visit",t)},track:function(t,e){this._track(t,"ce",e)},_track:function(t,e,i){var o=i||{};o.visitor!==void 0&&(this.cv=o.visitor,delete o.visitor),this._sync(t,e,o)},_sync:function(t,e,o){var n;n=new i.Event(t,o,this.cv,e),n.fire(this)},identify:function(t,e){t!==void 0&&""!==t&&(e!==void 0&&(this.cv=e),this.visitor("email",t),this._sync("identify","identify",{}))},visitor:function(t,e){"string"==typeof t&&e!==void 0?this.cv[t]=e:"object"==typeof t&&(this.cv=t)},visit:function(t,e){"string"==typeof t&&e!==void 0?this.cs[t]=e:"object"==typeof t&&(this.cs=t)},option:function(t,e){if(e===void 0){if("object"!=typeof t)return this.props[t];this.props=t}else this.props[t]=e;return e},setDomain:function(t){this.option("domain",t),this.option("cookie_domain",t)},setIdleTimeout:function(t){this.option("idle_timeout",t)},pingServer:function(){this._sync("x","ping",{})},typed:function(){this.vs=2},clicked:function(e){var o=this;o.moved();for(var n=e.srcElement||e.target;n!==void 0&&null!==n&&"A"!==n.tagNam;)n=n.parentNode;if(n!==void 0&&null!==n){var r=n,a=r.pathname.match(/(?:doc|dmg|eps|jpg|jpeg|png|svg|xls|ppt|pdf|xls|zip|txt|vsd|vxd|js|css|rar|exe|wma|mov|avi|wmv|mp3|mp4|m4v)($|\&)/),s=!1;o.option("download_tracking")&&a&&0>(""+r.href).indexOf("woopra-ns.com")&&(s=new i.Event("download",{url:r.href}),s.addProperty("url",r.href),s.fire(this),o.sleep(o.option("download_pause"))),o.option("outgoing_tracking")&&(a||r.hostname===t.location.host||-1!==r.hostname.indexOf("javascript")||""===r.hostname||(s=new i.Event("outgoing",{url:r.href}),s.fire(this),o.sleep(o.option("outgoing_pause"))))}},moved:function(){var t=this;t.last_activity=new Date,t.idle=0},next:function(){var t,e=this;e.ctr++,1e3*e.ctr>e.option("ping_interval")&&(e.ctr=0,e.option("ping")&&e.idle<e.option("idle_timeout")&&e.pingServer()),t=new Date,t-e.last_activity>1e4&&(e.idle=t-e.last_activity)}};var o=new i.Tracker;o.initialize(),t.WoopraScript=i.Script,t.exports!==void 0&&(t.exports.Woopra=i)})(window,document);